import{c as M,r as d,j as e,a0 as A,_ as k,p as z,x as $,D as V}from"./index-CpGugdsb.js";import{T as L}from"./trash-2-CgJvbinX.js";import{C as F}from"./clock-D4X49AFA.js";const Q=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],B=M("check-check",Q);const P=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],G=M("send",P),W=({currentUser:a,allUsers:o,conversations:f,messages:b,activeUserId:t,onSelectUser:r,onSendMessage:S,onDeleteMessage:T,onClearMessages:D,onClose:p})=>{const[i,j]=d.useState(""),[c,O]=d.useState(""),[x,m]=d.useState("conversations"),g=d.useRef(null),w=o.find(s=>s.id===t),h=a.role==="admin_dev"||a.role==="admin",N=h&&t,v=b.filter(s=>t?a.role==="admin_dev"||a.role==="admin"?s.senderId===t||s.receiverId===t:s.senderId===a.id&&s.receiverId===t||s.senderId===t&&s.receiverId===a.id:!1),_=o.filter(s=>s.id!==a.id&&(s.name.toLowerCase().includes(c.toLowerCase())||s.username.toLowerCase().includes(c.toLowerCase())));d.useEffect(()=>{g.current?.scrollIntoView({behavior:"smooth"})},[v]);const E=()=>{i.trim()&&t&&(S(t,i.trim()),j(""))},y=s=>s.charAt(0).toUpperCase(),C=s=>new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),R=()=>{window.confirm("⚠️ Tem certeza que deseja apagar TODO o histórico de mensagens do chat? Esta ação não pode ser desfeita.")&&D?.()},q=s=>{window.confirm("Deseja excluir esta mensagem?")&&T?.(s)};return e.jsxs("div",{className:"flex flex-col h-full bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-800 text-white flex items-center justify-between shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t?e.jsx("button",{onClick:()=>r(""),className:"hover:bg-slate-700 p-1 rounded-full transition-colors md:hidden",title:"Voltar para lista de conversas",children:e.jsx(A,{className:"w-5 h-5"})}):e.jsx(k,{className:"w-6 h-6 text-blue-400"}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-sm",children:t?w?.name:"Mensagens Internas"}),e.jsx("p",{className:"text-[10px] text-slate-300",children:t?w?.role:"Conectado como "+a.name})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h&&b.length>0&&e.jsx("button",{onClick:R,className:"p-2 text-rose-400 hover:text-rose-300 hover:bg-slate-700 rounded-full transition-all",title:"Limpar TODO o histórico do chat",children:e.jsx(L,{className:"w-5 h-5"})}),p&&e.jsx("button",{onClick:p,className:"text-slate-400 hover:text-white transition-colors",title:"Fechar chat",children:e.jsx(F,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:`w-full md:w-80 border-r border-slate-100 flex flex-col ${t?"hidden md:flex":"flex"}`,children:[e.jsxs("div",{className:"p-3 bg-slate-50 border-b border-slate-200",children:[e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),e.jsx("input",{type:"text",value:c,onChange:s=>O(s.target.value),placeholder:"Buscar colega...",className:"w-full pl-9 pr-3 py-2 bg-white border border-slate-200 rounded-full text-xs focus:ring-2 focus:ring-blue-500 focus:outline-none"})]}),e.jsxs("div",{className:"flex mt-3 bg-slate-200 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>m("conversations"),className:`flex-1 py-1.5 text-[10px] font-bold rounded-md transition-all ${x==="conversations"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Conversas"}),e.jsxs("button",{onClick:()=>m("users"),className:`flex-1 py-1.5 text-[10px] font-bold rounded-md transition-all ${x==="users"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:["Contatos (",o.length-1,")"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-white custom-scrollbar",children:x==="conversations"?f.length>0?f.map(s=>{const l=o.find(n=>n.id===s.userId);return l?e.jsxs("button",{onClick:()=>r(s.userId),className:`w-full p-4 flex items-center gap-3 border-b border-slate-50 transition-colors hover:bg-slate-50 ${t===s.userId?"bg-blue-50/50":""}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold text-white text-xs shadow-sm ${l.role.includes("admin")?"bg-tertiary":"bg-secondary"}`,children:l.photoURL?e.jsx("img",{src:l.photoURL,alt:"",className:"w-full h-full object-cover rounded-full"}):e.jsx("span",{children:y(l.name)})}),e.jsx("div",{className:`
                                                    absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-white shadow-sm
                                                    ${l.status==="Online"?"bg-green-500":l.status==="Ocupado"?"bg-amber-500":"bg-slate-400"}
                                                `})]}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-0.5",children:[e.jsx("h4",{className:"font-bold text-xs text-slate-800 truncate",children:l.name}),s.lastMessage&&e.jsx("span",{className:"text-[9px] text-slate-400",children:C(s.lastMessage.timestamp)})]}),e.jsxs("p",{className:"text-[10px] text-slate-500 truncate flex items-center gap-1",children:[s.lastMessage?.senderId===a.id&&e.jsx($,{className:"w-3 h-3"}),s.lastMessage?.text||"Sem mensagens..."]})]}),s.unreadCount>0&&e.jsx("div",{className:"bg-blue-600 text-white text-[9px] font-black h-5 w-5 rounded-full flex items-center justify-center shadow-md animate-pulse",children:s.unreadCount})]},s.userId):null}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(k,{className:"w-8 h-8 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Nenhuma conversa ativa."}),e.jsx("button",{onClick:()=>m("users"),className:"mt-2 text-xs font-bold text-blue-500",children:"Ver contatos"})]}):_.map(s=>e.jsxs("button",{onClick:()=>r(s.id),className:`w-full p-4 flex items-center gap-3 border-b border-slate-50 transition-colors hover:bg-slate-50 ${t===s.id?"bg-blue-50/50":""}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold text-white text-xs shadow-sm ${s.role.includes("admin")?"bg-tertiary":"bg-secondary"}`,children:s.photoURL?e.jsx("img",{src:s.photoURL,alt:"",className:"w-full h-full object-cover rounded-full"}):e.jsx("span",{children:y(s.name)})}),e.jsx("div",{className:`
                                            absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-white shadow-sm
                                            ${s.status==="Online"?"bg-green-500":s.status==="Ocupado"?"bg-amber-500":"bg-slate-400"}
                                        `})]}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h4",{className:"font-bold text-xs text-slate-800",children:s.name}),e.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-medium",children:s.role.replace("_"," ")})]})]},s.id))})]}),e.jsx("div",{className:`flex-1 flex flex-col bg-slate-50 ${t?"flex":"hidden md:flex"}`,children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar",children:[v.map((s,l)=>{const n=s.senderId===a.id,I=s.senderId===a.id&&s.receiverId===t||s.senderId===t&&s.receiverId===a.id;return e.jsx("div",{className:`flex ${n?"justify-end":"justify-start"} animate-fade-in group/msg`,children:e.jsxs("div",{className:`max-w-[80%] rounded-2xl p-3 shadow-sm relative ${n?"bg-blue-600 text-white rounded-tr-none":N&&!I?"bg-slate-200 text-slate-700 border-dashed border-slate-400":"bg-white text-slate-800 rounded-tl-none border border-slate-100"}`,children:[h&&e.jsx("button",{onClick:()=>s.id&&q(s.id),className:`absolute -top-2 ${n?"-left-2":"-right-2"} p-1.5 bg-rose-500 text-white rounded-full opacity-0 group-hover/msg:opacity-100 transition-opacity shadow-md hover:bg-rose-600 z-10`,title:"Excluir mensagem",children:e.jsx(L,{className:"w-3 h-3"})}),N&&!n&&e.jsxs("p",{className:"text-[9px] font-black uppercase mb-1 opacity-60",children:[o.find(u=>u.id===s.senderId)?.name||"Outro"," → ",o.find(u=>u.id===s.receiverId)?.name||"Outro"]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.text}),e.jsxs("div",{className:`flex items-center gap-1 mt-1 justify-end ${n?"text-blue-100":"text-slate-400"}`,children:[e.jsx("span",{className:"text-[9px]",children:C(s.timestamp)}),n&&(s.read?e.jsx(B,{className:"w-3 h-3"}):e.jsx($,{className:"w-3 h-3"}))]})]})},s.id||l)}),e.jsx("div",{ref:g})]}),e.jsx("div",{className:"p-4 bg-white border-t border-slate-200",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),E()},className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:i,onChange:s=>j(s.target.value),placeholder:"Digite sua mensagem...",className:"flex-1 px-4 py-2 bg-slate-50 border border-slate-200 rounded-full text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"}),e.jsx("button",{type:"submit",disabled:!i.trim(),className:"p-2.5 bg-blue-600 text-white rounded-full shadow-md hover:bg-blue-700 disabled:bg-slate-300 disabled:shadow-none transition-all active:scale-95",title:"Enviar mensagem",children:e.jsx(G,{className:"w-5 h-5"})})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center text-slate-400",children:[e.jsx("div",{className:"w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mb-6 border border-slate-200",children:e.jsx(V,{className:"w-10 h-10 text-slate-300"})}),e.jsx("h3",{className:"text-lg font-bold text-slate-600 mb-2",children:"Seu Central de Comunicação"}),e.jsx("p",{className:"text-sm max-w-xs leading-relaxed",children:"Selecione um colega de equipe na lista ao lado para iniciar uma conversa em tempo real."})]})})]})]})};export{W as default};
