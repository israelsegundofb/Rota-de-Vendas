import{c as b,r as i,j as e,o as M,i as q,p as V,X as _,q as U,s as W,t as R}from"./index-CpGugdsb.js";import{T}from"./trash-2-CgJvbinX.js";import{F as H}from"./file-spreadsheet-BULSMIt-.js";const K=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],G=b("arrow-down",K);const X=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],B=b("arrow-up",X);const J=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],k=b("sparkles",J);const O=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Q=b("upload",O),te=({products:h,onUploadProducts:I,onClearProducts:P,onSaveProducts:w})=>{const[v,C]=i.useState(!1),[l,S]=i.useState(""),[m,y]=i.useState(!1),[p,j]=i.useState({current:0,total:0}),[n,N]=i.useState([]),[s,A]=i.useState(null),[z,f]=i.useState(!1);i.useEffect(()=>{N(h),f(!1)},[h]);const E=async t=>{const r=t.target.files?.[0];if(r){C(!0);try{let o=[];const a=r.name.toLowerCase();if(a.endsWith(".csv"))o=await W(r);else if(a.endsWith(".xlsx")||a.endsWith(".xls"))o=await R(r);else throw new Error("Formato não suportado. Use .csv, .xlsx ou .xls");I(o),t.target.value=""}catch(o){console.error("Error parsing products:",o),alert("Erro ao processar arquivo de produtos. Verifique o formato.")}finally{C(!1)}}},L=()=>{w&&(w(n),f(!1),alert("Alterações salvas com sucesso!"))},$=async()=>{if(n.length===0){alert("Nenhum produto para categorizar.");return}if(window.confirm(`Deseja usar a IA para categorizar ${n.length} produtos?

Isso pode consumir créditos da API e levar alguns minutos.`)){y(!0),j({current:0,total:n.length});try{const t=await U(n,(r,o)=>{j({current:r,total:o})});N(t),f(!0),alert(`✓ ${t.length} produtos foram categorizados pela IA!`)}catch(t){console.error("AI Categorization failed",t),alert(`Erro ao categorizar produtos: ${t.message||"Erro desconhecido"}`)}finally{y(!1),j({current:0,total:0})}}},c=(t,r,o)=>{const a=[...n];a[t]={...a[t],[r]:o},N(a),f(!0)},d=t=>{let r="asc";s&&s.key===t&&s.direction==="asc"&&(r="desc"),A({key:t,direction:r})},D=t=>s?[...t].sort((r,o)=>{let a=r[s.key],x=o[s.key];return s.key==="price"||s.key==="discount"?(a=Number(a||0),x=Number(x||0)):(a=String(a||"").toLowerCase(),x=String(x||"").toLowerCase()),a<x?s.direction==="asc"?-1:1:a>x?s.direction==="asc"?1:-1:0}):t,F=n.map((t,r)=>({...t,originalIndex:r})).filter(t=>(t.name||"").toLowerCase().includes(l.toLowerCase())||(t.sku||"").toLowerCase().includes(l.toLowerCase())||(t.brand||"").toLowerCase().includes(l.toLowerCase())||(t.category||"").toLowerCase().includes(l.toLowerCase())||(t.factoryCode||"").toLowerCase().includes(l.toLowerCase())),g=D(F),u=({column:t})=>s?.key!==t?e.jsx("div",{className:"w-4 h-4 ml-1 inline-block opacity-0 group-hover:opacity-30",children:"↕"}):s.direction==="asc"?e.jsx(B,{className:"w-3 h-3 ml-1 inline-block text-primary"}):e.jsx(G,{className:"w-3 h-3 ml-1 inline-block text-primary"});return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto space-y-6 animate-fade-in h-full flex flex-col pb-20",children:[e.jsxs("div",{className:"bg-white rounded-[28px] shadow-elevation-1 p-6 flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6 shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-normal text-on-surface flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-primary"}),"Catálogo de Produtos"]}),e.jsx("p",{className:"text-sm text-on-surface-variant mt-1",children:"Gerencie preços, descontos e categorias."})]}),e.jsxs("div",{className:"flex gap-3 items-center flex-wrap",children:[z&&e.jsxs("button",{onClick:L,className:"px-6 py-2 bg-tertiary-container text-on-tertiary-container hover:bg-tertiary-container/80 rounded-full text-sm font-medium flex items-center gap-2 transition-all shadow-elevation-1 animate-pulse",children:[e.jsx(q,{className:"w-4 h-4"})," Salvar Alterações"]}),h.length>0&&e.jsxs("button",{onClick:$,disabled:m,className:"px-6 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:from-purple-600 hover:to-pink-600 rounded-full text-sm font-medium flex items-center gap-2 transition-all shadow-elevation-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[m?e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}):e.jsx(k,{className:"w-4 h-4"}),m?"Processando...":"IA Classificar"]}),h.length>0&&e.jsxs("button",{onClick:P,className:"px-6 py-2 border border-error/50 text-error hover:bg-error-container/30 rounded-full text-sm font-medium flex items-center gap-2 transition-colors",children:[e.jsx(T,{className:"w-4 h-4"})," Limpar"]}),e.jsxs("label",{className:`px-6 py-2 bg-primary text-on-primary rounded-full hover:bg-primary/90 text-sm font-medium flex items-center gap-2 cursor-pointer transition-all shadow-elevation-1 hover:shadow-elevation-2 ${v?"opacity-50 pointer-events-none":""}`,children:[v?e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-on-primary border-t-transparent rounded-full"}):e.jsx(Q,{className:"w-4 h-4"}),v?"Processando...":"Importar CSV",e.jsx("input",{type:"file",accept:".csv",className:"hidden",onChange:E})]})]})]}),h.length===0?e.jsxs("div",{className:"border border-dashed border-outline-variant rounded-[16px] p-12 text-center bg-surface-container-low flex-1 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-16 h-16 bg-surface-container-highest rounded-full flex items-center justify-center mb-4",children:e.jsx(H,{className:"w-8 h-8 text-outline"})}),e.jsx("p",{className:"text-on-surface font-medium",children:"Nenhum produto cadastrado."}),e.jsx("p",{className:"text-sm text-on-surface-variant mt-1",children:"Carregue um arquivo CSV para começar."})]}):e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[e.jsxs("div",{className:"mb-4 relative flex-shrink-0",children:[e.jsx(V,{className:"absolute left-3 top-2.5 w-4 h-4 text-on-surface-variant"}),e.jsx("input",{type:"text",value:l,onChange:t=>S(t.target.value),placeholder:"Filtrar por SKU, Marca, Departamento, Nome...",className:"w-full pl-10 pr-4 py-2 bg-surface-container-highest border-b border-outline-variant rounded-t-lg text-on-surface focus:border-primary focus:bg-surface-container-highest outline-none transition-colors text-sm"})]}),e.jsx("div",{className:"hidden md:block flex-1 overflow-auto border border-outline-variant/30 rounded-xl shadow-inner scrollbar-thin scrollbar-thumb-outline-variant scrollbar-track-surface-container-low",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-on-surface-variant uppercase bg-surface-container-highest/80 sticky top-0 z-10 backdrop-blur-sm",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"px-4 py-3 cursor-pointer hover:bg-surface-container-highest group select-none w-24",onClick:()=>d("sku"),children:["SKU ",e.jsx(u,{column:"sku"})]}),e.jsxs("th",{className:"px-4 py-3 cursor-pointer hover:bg-surface-container-highest group select-none w-32",onClick:()=>d("brand"),children:["Marca ",e.jsx(u,{column:"brand"})]}),e.jsxs("th",{className:"px-4 py-3 cursor-pointer hover:bg-surface-container-highest group select-none min-w-[200px]",onClick:()=>d("name"),children:["Produto ",e.jsx(u,{column:"name"})]}),e.jsxs("th",{className:"px-4 py-3 cursor-pointer hover:bg-surface-container-highest group select-none w-40",onClick:()=>d("category"),children:["Departamento ",e.jsx(u,{column:"category"})]}),e.jsxs("th",{className:"px-4 py-3 text-right cursor-pointer hover:bg-surface-container-highest group select-none w-32",onClick:()=>d("price"),children:["Preço (R$) ",e.jsx(u,{column:"price"})]}),e.jsxs("th",{className:"px-4 py-3 text-right cursor-pointer hover:bg-surface-container-highest group select-none w-28",onClick:()=>d("discount"),children:["Desc. (%) ",e.jsx(u,{column:"discount"})]})]})}),e.jsx("tbody",{className:"divide-y divide-outline-variant/30 bg-surface",children:g.map(t=>e.jsxs("tr",{className:"hover:bg-surface-container-highest/30 transition-colors group",children:[e.jsx("td",{className:"px-4 py-2 font-mono text-on-surface-variant text-xs",children:t.sku}),e.jsx("td",{className:"px-4 py-2 font-bold text-primary text-xs uppercase",children:t.brand}),e.jsx("td",{className:"px-4 py-2 font-medium text-on-surface text-xs truncate max-w-xs",title:t.name,children:t.name}),e.jsx("td",{className:"px-2 py-2",children:e.jsx("input",{type:"text",className:"w-full text-xs text-on-surface border-transparent bg-transparent hover:bg-surface-container-highest/50 focus:bg-surface-container-highest focus:border-primary focus:ring-0 border-b focus:border-b-2 rounded-t transition-all px-2 py-1 outline-none",value:t.category,onChange:r=>c(t.originalIndex,"category",r.target.value),title:"Editar Categoria",placeholder:"Categoria"})}),e.jsx("td",{className:"px-2 py-2 text-right",children:e.jsx("input",{type:"number",step:"0.01",className:"w-full text-xs text-right font-bold text-primary border-transparent bg-transparent hover:bg-surface-container-highest/50 focus:bg-surface-container-highest focus:border-primary focus:ring-0 border-b focus:border-b-2 rounded-t transition-all px-2 py-1 outline-none",value:t.price,onChange:r=>c(t.originalIndex,"price",parseFloat(r.target.value)||0),title:"Editar Preço",placeholder:"0,00"})}),e.jsx("td",{className:"px-2 py-2 text-right",children:e.jsx("input",{type:"number",step:"0.1",min:"0",max:"100",className:"w-full text-xs text-right text-tertiary border-transparent bg-transparent hover:bg-surface-container-highest/50 focus:bg-surface-container-highest focus:border-tertiary focus:ring-0 border-b focus:border-b-2 rounded-t transition-all px-2 py-1 outline-none",value:t.discount||0,onChange:r=>c(t.originalIndex,"discount",parseFloat(r.target.value)||0),title:"Editar Desconto",placeholder:"0.0"})})]},`${t.sku}-${t.originalIndex}`))})]})}),e.jsxs("div",{className:"md:hidden space-y-4 pb-4",children:[g.map(t=>e.jsxs("div",{className:"bg-surface-container-highest/30 p-4 rounded-xl border border-outline-variant/30 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-mono text-on-surface-variant mb-1",children:t.sku}),e.jsx("h3",{className:"font-bold text-sm text-on-surface line-clamp-2 leading-tight",children:t.name}),e.jsx("p",{className:"text-xs text-primary mt-1 font-medium",children:t.brand})]}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"text-[10px] bg-surface-container-high px-2 py-1 rounded text-on-surface-variant font-mono block mb-1",children:t.factoryCode})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2 border-t border-outline-variant/20",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] uppercase text-on-surface-variant font-bold",children:"Departamento"}),e.jsx("input",{type:"text",className:"w-full text-xs bg-surface-container-highest/50 border-b border-outline-variant rounded-t px-2 py-1.5 focus:border-primary outline-none",value:t.category,onChange:r=>c(t.originalIndex,"category",r.target.value),title:"Editar Departamento",placeholder:"Departamento"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] uppercase text-on-surface-variant font-bold",children:"Desconto (%)"}),e.jsx("input",{type:"number",className:"w-full text-xs bg-surface-container-highest/50 border-b border-outline-variant rounded-t px-2 py-1.5 focus:border-tertiary outline-none text-tertiary font-bold",value:t.discount||0,onChange:r=>c(t.originalIndex,"discount",parseFloat(r.target.value)||0),title:"Editar Desconto",placeholder:"0"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] uppercase text-on-surface-variant font-bold",children:"Preço de Venda (R$)"}),e.jsx("input",{type:"number",className:"w-full text-sm bg-surface-container-highest/50 border-b border-outline-variant rounded-t px-2 py-2 focus:border-primary outline-none text-primary font-bold",value:t.price,onChange:r=>c(t.originalIndex,"price",parseFloat(r.target.value)||0),title:"Editar Preço",placeholder:"0,00"})]})]},`${t.sku}-${t.originalIndex}`)),g.length===0&&e.jsx("p",{className:"text-center text-on-surface-variant text-sm py-4",children:"Nenhum produto encontrado."})]}),e.jsxs("div",{className:"mt-4 text-xs text-on-surface-variant flex justify-between px-2",children:[e.jsxs("span",{children:["Total de Produtos: ",e.jsx("strong",{children:n.length})]}),e.jsxs("span",{children:["Exibindo: ",e.jsx("strong",{children:g.length})]})]})]})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-surface rounded-[24px] shadow-elevation-5 p-6 max-w-md w-full animate-scale-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-on-surface flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-purple-500"}),"Categorizando com IA"]}),e.jsx("button",{onClick:()=>{window.confirm("Deseja realmente cancelar a categorização?")&&y(!1)},className:"text-on-surface-variant hover:text-on-surface",title:"Cancelar categorização IA",children:e.jsx(_,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm text-on-surface-variant",children:[e.jsx("span",{children:"Processando produtos..."}),e.jsxs("span",{className:"font-mono font-bold text-primary",children:[p.current," / ",p.total]})]}),e.jsx("div",{className:"h-2 bg-surface-container-highest rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-300",style:{width:`${p.current/p.total*100}%`}})}),e.jsx("p",{className:"text-xs text-on-surface-variant",children:"A IA está analisando cada produto e atribuindo categorias automaticamente."})]})]})})]})};export{te as default};
