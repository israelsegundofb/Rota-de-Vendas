import{c as M,r as l,e as ee,f as m,j as e,X as G,U as S,h as ae,i as se,C as H,k as q,B as te,l as P,m as J,n as re}from"./index-CpGugdsb.js";import{T as X}from"./trash-2-CgJvbinX.js";const oe=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],ne=M("camera",oe);const le=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],T=M("pencil",le);const ie=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Y=M("user-plus",ie),ce=(t,x=200,f=200,k=.7)=>new Promise((N,g)=>{const u=new FileReader;u.readAsDataURL(t),u.onload=s=>{const i=new Image;i.src=s.target?.result,i.onload=()=>{const n=document.createElement("canvas");let r=i.width,o=i.height;r>o?r>x&&(o=Math.round(o*=x/r),r=x):o>f&&(r=Math.round(r*=f/o),o=f),n.width=r,n.height=o;const h=n.getContext("2d");if(!h){g(new Error("Could not get canvas context"));return}h.drawImage(i,0,0,r,o);const b=n.toDataURL("image/jpeg",k);N(b)},i.onerror=n=>g(n)},u.onerror=s=>g(s)}),ue=({currentUser:t,users:x,onAddUser:f,onUpdateUser:k,onDeleteUser:N,onCleanupDuplicates:g,totalClients:u})=>{const[s,i]=l.useState(null),[n,r]=l.useState(""),[o,h]=l.useState(""),[b,L]=l.useState(""),A=ee(t.role),F=A.includes("sales_external")?"sales_external":A[0],[w,I]=l.useState(F),[_,U]=l.useState("Externo"),[$,C]=l.useState("#3B82F6"),[v,E]=l.useState(void 0),j=l.useRef(null),[R,K]=l.useState("Todos"),B=()=>{i(null),r(""),h(""),L(""),I(F),U("Externo"),C("#3B82F6"),E(void 0),j.current&&(j.current.value="")},D=a=>{if(!P(t.role,a.role)){alert("Você não tem permissão para editar este usuário (Nível Hierárquico Superior ou Igual).");return}i(a.id),r(a.name),h(a.username),L(a.password||""),I(re(a.role)),U(a.salesCategory||"N/A"),C(a.color||"#3B82F6"),E(a.photoURL),window.scrollTo({top:0,behavior:"smooth"})},Q=async a=>{const d=a.target.files?.[0];if(d){if(!["image/jpeg","image/png"].includes(d.type)){alert("Apenas imagens JPEG ou PNG são permitidas.");return}if(d.size>2*1024*1024){alert("A imagem deve ter no máximo 2MB.");return}try{const c=await ce(d);E(c)}catch(c){console.error("Erro ao processar imagem:",c),alert("Erro ao processar a imagem. Tente novamente.")}}},Z=a=>{a.preventDefault();const d=n.trim(),c=o.trim(),z=b.trim();if(!d||!c||!z)return;if(x.some(V=>V.id!==s&&V.username.toLowerCase()===c.toLowerCase())){alert(`⚠️ O usuário "${c}" já está cadastrado no sistema. Escolha outro nome de usuário.`);return}const O=m[w]>=4,p={id:s||Date.now().toString(),name:d,username:c,role:w,password:z,salesCategory:O?_:"N/A",color:O?$:void 0,photoURL:v};s?(k(p),J({userId:t.id,userName:t.name,userRole:t.role,action:"UPDATE",category:"USERS",details:`Atualizou o usuário: ${p.name} (${p.username})`,timestamp:new Date().toISOString()})):(f(p),J({userId:t.id,userName:t.name,userRole:t.role,action:"CREATE",category:"USERS",details:`Criou novo usuário: ${p.name} (${p.username})`,timestamp:new Date().toISOString()})),B()},y=x.filter(a=>R==="Todos"||R==="N/A"&&m[a.role]<=2?!0:a.salesCategory===R),W=["Todos","Externo","Interno","Mercado Livre"];return e.jsxs("div",{className:"p-6 max-w-5xl mx-auto space-y-8 animate-fade-in pb-20",children:[e.jsxs("div",{className:`bg-white rounded-[28px] shadow-elevation-1 p-6 transition-all border ${s?"border-primary ring-2 ring-primary/20":"border-transparent"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:`text-xl font-normal flex items-center gap-2 ${s?"text-primary":"text-on-surface"}`,children:[s?e.jsx(T,{className:"w-5 h-5"}):e.jsx(Y,{className:"w-5 h-5 text-primary"}),s?"Editar Usuário":"Cadastrar Novo Usuário"]}),s&&e.jsxs("button",{onClick:B,className:"text-sm text-on-surface-variant hover:text-on-surface flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4"})," Cancelar Edição"]})]}),e.jsxs("form",{onSubmit:Z,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-3 flex justify-center mb-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:`w-24 h-24 rounded-full overflow-hidden border-2 flex items-center justify-center bg-surface-container-highest ${v?"border-primary":"border-dashed border-outline-variant"}`,children:v?e.jsx("img",{src:v,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(S,{className:"w-10 h-10 text-on-surface-variant/50"})}),e.jsxs("label",{htmlFor:"photo-upload",className:"absolute bottom-0 right-0 p-1.5 bg-primary text-on-primary rounded-full shadow-md cursor-pointer hover:bg-primary/90 transition-colors",title:"Alterar foto",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("input",{id:"photo-upload",type:"file",accept:"image/jpeg, image/png",onChange:Q,className:"hidden",ref:j})]}),v&&e.jsx("button",{type:"button",onClick:()=>{E(void 0),j.current&&(j.current.value="")},className:"absolute -top-1 -right-1 p-1 bg-error text-white rounded-full shadow-md hover:bg-error/90 transition-colors",title:"Remover foto",children:e.jsx(G,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"ml-4 flex flex-col justify-center",children:[e.jsx("span",{className:"text-sm font-medium text-on-surface",children:"Foto de Perfil"}),e.jsx("span",{className:"text-xs text-on-surface-variant",children:"JPG ou PNG até 2MB."})]})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-on-surface-variant mb-1 ml-1",children:"Nome Completo"}),e.jsx("input",{type:"text",value:n,onChange:a=>r(a.target.value),className:"w-full bg-surface-container-highest border-b border-outline-variant rounded-t-lg px-4 py-2.5 text-on-surface focus:border-primary focus:bg-surface-container-highest outline-none transition-colors",placeholder:"Ex: Carlos Oliveira"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-on-surface-variant mb-1 ml-1",children:"Usuário de Login"}),e.jsx("input",{type:"text",value:o,onChange:a=>h(a.target.value),className:"w-full bg-surface-container-highest border-b border-outline-variant rounded-t-lg px-4 py-2.5 text-on-surface focus:border-primary focus:bg-surface-container-highest outline-none transition-colors",placeholder:"Ex: vendedor_carlos"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-on-surface-variant mb-1 ml-1",children:"Senha"}),e.jsx("input",{type:"text",value:b,onChange:a=>L(a.target.value),className:"w-full bg-surface-container-highest border-b border-outline-variant rounded-t-lg px-4 py-2.5 text-on-surface focus:border-primary focus:bg-surface-container-highest outline-none transition-colors",placeholder:"Senha de acesso"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-on-surface-variant mb-1 ml-1",children:"Perfil de Acesso"}),e.jsx("select",{value:w,onChange:a=>I(a.target.value),className:"w-full bg-surface-container-highest border-b border-outline-variant rounded-t-lg px-4 py-2.5 text-on-surface focus:border-primary focus:bg-surface-container-highest outline-none appearance-none cursor-pointer",children:A.map(a=>e.jsx("option",{value:a,children:ae[a]||a},a))}),e.jsx("p",{className:"text-[10px] text-on-surface-variant mt-1 pl-1",children:"* Você só pode criar níveis abaixo do seu."})]}),m[w]>=4&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("label",{className:"block text-xs font-medium text-on-surface-variant mb-1 ml-1",children:"Categoria de Venda"}),e.jsxs("select",{value:_,onChange:a=>U(a.target.value),className:"w-full bg-surface-container-highest border-b border-outline-variant rounded-t-lg px-4 py-2.5 text-on-surface focus:border-primary focus:bg-surface-container-highest outline-none appearance-none cursor-pointer",children:[e.jsx("option",{value:"Externo",children:"Externo"}),e.jsx("option",{value:"Interno",children:"Interno"}),e.jsx("option",{value:"Mercado Livre",children:"Mercado Livre"})]})]}),e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("label",{className:"block text-xs font-medium text-on-surface-variant mb-1 ml-1",children:"Cor do Vendedor (Mapa)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:$,onChange:a=>C(a.target.value),className:"h-10 w-16 p-0 border-0 rounded overflow-hidden cursor-pointer",title:"Escolher cor"}),e.jsx("input",{type:"text",value:$,onChange:a=>C(a.target.value),className:"flex-1 bg-surface-container-highest border-b border-outline-variant rounded-t-lg px-4 py-2 text-on-surface focus:border-primary focus:bg-surface-container-highest outline-none transition-colors uppercase",placeholder:"#000000",maxLength:7})]})]})]}),e.jsx("div",{className:"lg:col-span-3 pt-2 flex justify-end",children:e.jsxs("button",{type:"submit",disabled:!n||!o||!b,className:`px-6 py-2.5 rounded-full font-medium transition-all shadow-elevation-1 hover:shadow-elevation-2 flex items-center gap-2 ${s?"bg-primary-container text-on-primary-container hover:bg-primary-container/80":"bg-primary text-on-primary hover:bg-primary/90"} disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none`,children:[s?e.jsx(se,{className:"w-4 h-4"}):e.jsx(Y,{className:"w-4 h-4"}),s?"Salvar Alterações":"Criar Acesso"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-[28px] shadow-elevation-1 overflow-hidden",children:[e.jsxs("div",{className:"bg-white rounded-[28px] shadow-elevation-1 p-6 space-y-4",children:[e.jsxs("h2",{className:"text-xl font-normal flex items-center gap-2 text-on-surface",children:[e.jsx(S,{className:"w-5 h-5 text-primary"}),"Usuários Cadastrados (",y.length,")"]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-2xl p-4 flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(H,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-900",children:"Manutenção do Sistema"}),e.jsxs("p",{className:"text-xs text-yellow-700 mt-1",children:["Total de clientes no sistema: ",e.jsx("strong",{children:u}),u>143&&e.jsx("span",{className:"text-red-600",children:" • Possíveis duplicatas detectadas"})]})]})]}),e.jsxs("button",{onClick:g,className:"px-4 py-2 bg-yellow-600 text-white rounded-full text-sm font-medium hover:bg-yellow-700 transition-colors flex items-center gap-2 whitespace-nowrap",children:[e.jsx(H,{className:"w-4 h-4"}),"Limpar Duplicatas"]})]}),e.jsx("div",{className:"flex bg-surface-container-highest p-1 rounded-full",children:W.map(a=>e.jsx("button",{onClick:()=>K(a),className:`px-4 py-1.5 text-xs font-medium rounded-full transition-all ${R===a?"bg-white text-on-surface shadow-sm":"text-on-surface-variant hover:text-on-surface"}`,children:a},a))})]}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-on-surface-variant uppercase bg-surface-container-highest/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 font-medium",children:"Nome"}),e.jsx("th",{className:"px-6 py-4 font-medium",children:"Usuário"}),e.jsx("th",{className:"px-6 py-4 font-medium",children:"Função"}),e.jsx("th",{className:"px-6 py-4 font-medium",children:"Categoria"}),e.jsx("th",{className:"px-6 py-4 font-medium",children:"Cor"}),e.jsx("th",{className:"px-6 py-4 font-medium text-right",children:"Ações"})]})}),e.jsxs("tbody",{className:"divide-y divide-outline-variant/30",children:[y.map(a=>e.jsxs("tr",{className:`hover:bg-surface-container-highest/30 transition-colors ${s===a.id?"bg-primary-container/30":""}`,children:[e.jsx("td",{className:"px-6 py-4 font-medium text-on-surface",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden border border-outline-variant/30",children:a.photoURL?e.jsx("img",{src:a.photoURL,alt:a.name,className:"w-full h-full object-cover"}):e.jsx(S,{className:"w-4 h-4 text-primary"})}),a.name]})}),e.jsx("td",{className:"px-6 py-4 text-on-surface-variant",children:a.username}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wide border ${m[a.role]<=2?"bg-tertiary-container text-on-tertiary-container border-tertiary-container":"bg-secondary-container text-on-secondary-container border-secondary-container"}`,children:q(a.role)})}),e.jsx("td",{className:"px-6 py-4",children:m[a.role]>=4?e.jsxs("span",{className:"flex items-center gap-1 text-xs text-on-surface-variant",children:[e.jsx(te,{className:"w-3.5 h-3.5"}),a.salesCategory||"N/A"]}):e.jsx("span",{className:"text-outline-variant",children:"-"})}),e.jsx("td",{className:"px-6 py-4",children:m[a.role]>=4&&a.color?e.jsx("div",{className:"flex items-center gap-2",title:a.color,children:e.jsx("div",{className:"w-6 h-6 rounded-full border border-gray-200 shadow-sm",style:{backgroundColor:a.color}})}):e.jsx("span",{className:"text-outline-variant",children:"-"})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("div",{className:"flex items-center justify-end gap-2",children:P(t.role,a.role)?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>D(a),className:"p-2 text-primary hover:bg-primary-container/30 rounded-full transition-colors",title:"Editar",children:e.jsx(T,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>N(a.id),className:"p-2 text-error hover:bg-error-container/30 rounded-full transition-colors",title:"Remover",children:e.jsx(X,{className:"w-4 h-4"})})]}):e.jsx("div",{className:"flex items-center gap-2 opacity-30 cursor-not-allowed",children:e.jsx("span",{className:"text-xs italic",children:"Sem permissão"})})})})]},a.id)),y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-on-surface-variant",children:"Nenhum usuário encontrado para este filtro."})})]})]})}),e.jsxs("div",{className:"md:hidden space-y-4 p-4",children:[y.map(a=>e.jsxs("div",{className:`bg-surface-container-highest/30 rounded-xl p-4 border border-outline-variant/30 ${s===a.id?"bg-primary-container/30 border-primary/30":""}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden border border-outline-variant/30 flex-shrink-0",children:a.photoURL?e.jsx("img",{src:a.photoURL,alt:a.name,className:"w-full h-full object-cover"}):e.jsx(S,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-on-surface",children:a.name}),e.jsxs("p",{className:"text-xs text-on-surface-variant",children:["@",a.username]})]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wide border ${m[a.role]<=2?"bg-tertiary-container text-on-tertiary-container border-tertiary-container":"bg-secondary-container text-on-secondary-container border-secondary-container"}`,children:q(a.role)})]}),e.jsxs("div",{className:"space-y-2 text-sm text-on-surface-variant mb-4",children:[e.jsxs("div",{className:"flex justify-between border-b border-outline-variant/20 pb-1",children:[e.jsx("span",{children:"Categoria:"}),e.jsx("span",{className:"font-medium text-on-surface",children:a.salesCategory||"-"})]}),e.jsxs("div",{className:"flex justify-between border-b border-outline-variant/20 pb-1",children:[e.jsx("span",{children:"Senha:"}),e.jsx("span",{className:"font-mono",children:a.password||"***"})]})]}),e.jsx("div",{className:"flex justify-end gap-2 pt-2",children:P(t.role,a.role)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>D(a),className:"px-3 py-1.5 bg-primary/10 text-primary rounded-lg text-xs font-medium flex items-center gap-1 hover:bg-primary/20 transition-colors",children:[e.jsx(T,{className:"w-3.5 h-3.5"})," Editar"]}),e.jsxs("button",{onClick:()=>N(a.id),className:"px-3 py-1.5 bg-error/10 text-error rounded-lg text-xs font-medium flex items-center gap-1 hover:bg-error/20 transition-colors",children:[e.jsx(X,{className:"w-3.5 h-3.5"})," Remover"]})]})})]},a.id)),y.length===0&&e.jsx("p",{className:"text-center text-on-surface-variant py-8 text-sm",children:"Nenhum usuário encontrado."})]})]})]})};export{ue as default};
